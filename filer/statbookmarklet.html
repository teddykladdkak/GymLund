<!DOCTYPE html>
<html>
<head>
	<title>Pokemon...</title>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
	<meta content="yes" name="apple-mobile-web-app-capable" />
	<meta content="yes" name="mobile-web-app-capable" />
	<meta content="minimum-scale=1.0, width=device-width, maximum-scale=0.6667, user-scalable=no" name="viewport" />
	<meta name="apple-mobile-web-app-status-bar-style" content="black" />

	<link rel="stylesheet" type="text/css" href="img/pokemon/sprite.css">

	<script type="text/javascript">
		var spritepokemon = 386;
		function addimages(){
			var wrapper = document.getElementById('bilder');
			for (var i = 1; i < spritepokemon + 1; i++){
				var elem = document.createElement('i');
					if(localStorage.getItem('pokeselect' + i)){
						elem.setAttribute('class', 'sprite sprite-' + i + ' marked');
						elem.setAttribute('data-chosen', true);
					}else{
						elem.setAttribute('class', 'sprite sprite-' + i);
					};
					elem.setAttribute('onclick', 'mark(this)');
					elem.setAttribute('data-number', i);
					elem.setAttribute('data-class', 'sprite sprite-' + i);
				wrapper.appendChild(elem);
			};
			/*var rader = Math.ceil(antal / collumner);
			var arrayrader = [];for (var i = rader - 1; i >= 0; i--) {for (var y = collumner - 1; y >= 0; y--) {arrayrader.push(i * size);};};arrayrader.reverse();
			var arraycol = [];for (var i = rader - 1; i >= 0; i--) {for (var y = collumner - 1; y >= 0; y--) {arraycol.push(y * size);};};arraycol.reverse();
			var wrapper = document.getElementById('bilder');
			for (var i = antal - 1; i >= 0; i--) {
				var span = document.createElement('span');
					span.setAttribute('style', 'background-position:-' + arraycol[i] + 'px -' + arrayrader[i] + 'px;');
					span.setAttribute('data-style', 'background-position:-' + arraycol[i] + 'px -' + arrayrader[i] + 'px;');
					if(localStorage.getItem('pokeselect' + (startnummer + i + 1))){
						span.setAttribute('class', stil + ' marked');
						span.setAttribute('data-chosen', true);
					}else{
						span.setAttribute('class', stil);
					};
					span.setAttribute('data-class', stil);
					span.setAttribute('onclick', 'mark(this)');
					span.setAttribute('data-number', startnummer + i + 1);
					var spantext = document.createTextNode(startnummer + i + 1);
					span.appendChild(spantext);
				wrapper.insertBefore(span, wrapper.firstChild);
			};*/
		};
		function onload(){
			var meny = document.getElementById('meny');
			if(!localStorage.getItem('remember_select_exclude')){}else{
				console.log('Nya pokemon har injicerats på sidan, ändrar i local localStorage');
				var elementstosave = localStorage.getItem('remember_select_exclude').replace('[', '').replace(']', '').split(',');
				localStorage.clear();
				console.log(elementstosave);
				console.log(elementstosave[1]);
				for (var i = elementstosave.length - 1; i >= 0; i--) {
					localStorage.setItem('pokeselect' + elementstosave[i], true);
				};
			};
			// addimages(100, 16, 'gentva', 151, 50);
			// addimages(151, 5, 'genett', 0, 50);
			addimages();
		};
		function mark(element){
			if(!element.getAttribute('data-chosen')){
				element.setAttribute('class', element.getAttribute('data-class') + ' marked');
				element.setAttribute('data-chosen', true);
				localStorage.setItem('pokeselect' + element.getAttribute('data-number'), true);
			}else{
				element.setAttribute('class', element.getAttribute('data-class'));
				element.removeAttribute('data-chosen');
				localStorage.removeItem('pokeselect' + element.getAttribute('data-number'));
			};
		};
		function make(bookmarklettext){
			var allmarked = document.getElementsByClassName('marked');
			var allmarkedarray = [];
			for (var i = allmarked.length - 1; i >= 0; i--) {
				allmarkedarray.push(allmarked[i].getAttribute('data-number'));
			};
			allmarkedarray.reverse();
			//var person = prompt('Aktivera kod på pokekartan', 'javascript:(function(){localStorage.setItem("remember_select_exclude", "[' + allmarkedarray + ']");location.reload();})();');
			var wrapper = document.getElementById('bookmarkletwrapper');
			while (wrapper.hasChildNodes()) {wrapper.removeChild(wrapper.firstChild);};
				var link = document.createElement('a');
					link.setAttribute('href', 'javascript:(function(){localStorage.setItem("remember_select_exclude", "[' + allmarkedarray + ']");location.reload();})();');
					var linktext = document.createTextNode(bookmarklettext);
					link.appendChild(linktext);
				wrapper.appendChild(link);


			link.addEventListener("click", function(event){
			    event.preventDefault();
			    alert('Det hjälper inte att klicka. För att installera bookmarkleten måste du dra texten till bokmärkesfältet.');
			});
		};
		function stats(bookmarklettext){
			var allmarked = document.getElementsByClassName('marked');
			var allmarkedarray = [];
			for (var i = allmarked.length - 1; i >= 0; i--) {
				allmarkedarray.push(parseInt(allmarked[i].getAttribute('data-number')));
			};
			allmarkedarray.reverse();
			var statsarray = allmarkedarray.join(',');
			console.log(statsarray);
			
			var wrapper = document.getElementById('bookmarkletwrapper');
			while (wrapper.hasChildNodes()) {wrapper.removeChild(wrapper.firstChild);};
				var link = document.createElement('a');
					link.setAttribute('href', 'javascript:(function(){var alltohide = "' + statsarray + '".split(",");for (var i = alltohide.length - 1; i >= 0; i--) {var element = document.getElementById("seen_" + alltohide[i]);if(!element){}else{element.setAttribute("style", "display: none;");};};})();');
					var linktext = document.createTextNode(bookmarklettext);
					link.appendChild(linktext);
				wrapper.appendChild(link);


			link.addEventListener("click", function(event){
			    event.preventDefault();
			    alert('Det hjälper inte att klicka. För att installera bookmarkleten måste du dra texten till bokmärkesfältet.')
			});

			
		};
		function valj(todo){
			var allspan = document.getElementById('bilder').getElementsByTagName('i');
			for (var i = allspan.length - 1; i >= 0; i--) {
				if(todo == 'alla'){
					allspan[i].setAttribute('class', allspan[i].getAttribute('data-class'));
					allspan[i].removeAttribute('data-chosen');
					localStorage.removeItem('pokeselect' + allspan[i].getAttribute('data-number'));
				}else{
					allspan[i].setAttribute('class', allspan[i].getAttribute('data-class') + ' marked');
					allspan[i].setAttribute('data-chosen', true);
					localStorage.setItem('pokeselect' + allspan[i].getAttribute('data-number'), true);
				};
			};
		};
	</script>
	<style type="text/css">
		#meny{
			zoom: 2;
		}
		.genett{
			background-image: url("https://rankedboost.com/wp-content/plugins/ice/riot/poksimages/poksSprite.png");
		}
		.gentva{
			background-image: url("https://rankedboost.com/wp-content/plugins/ice/riot/poksimages/poks_gen2_sp.png");
		}
		#bilder {
			padding-top: 100px;
			-webkit-user-select: none;
			-moz-user-select: none;
			-ms-user-select: none;
			-o-user-select: none;
			user-select: none;
		}
		#bilder span {
			display: inline-block;
			width: 50px;
			height: 50px;
			vertical-align: text-bottom;
		}
		.marked{
			opacity: 0.5;
		}
		#meny{
			position: fixed;
			left: 0px;
			top: 0px;
			z-index: 1;
			background-color: #000;
			width: 100%;
		}
		#meny #bookmarkletwrapper, #meny #bookmarkletwrapper a, #meny #bookmarkletwrapper a:hover{
			background-color: blue;
			color: #FFF;
		}
	</style>
</head>
<body onload="onload();">
<div id="meny"><input type="button" onclick="valj('alla')" value="Välj alla" name=""><input type="button" value="Välj ingen" onclick="valj('ingen')" name=""><input type="button" value="Skapa bookmarklet för karta" onclick="make('Dra denna text till bokmärkesfältet');" name=""><input type="button" value="Skapa bookmarklet för stats" onclick="stats('Dra denna text till bokmärkesfältet');" name=""><input type="button" value="Kvar att fånga (Karta)" onclick="make('Kvar att fånga (Karta)');" name=""><input type="button" value="Kvar att fånga (Stats)" onclick="stats('Kvar att fånga (Stats)');" name=""><span id="bookmarkletwrapper"></span></div>
<div id="bilder"></div>
</body>
</html>